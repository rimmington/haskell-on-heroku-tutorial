dependencies:
  cache_directories:
    - /app

  override:
    - sudo mkdir -p /app
    - sudo chown $USER /app
    - git clone https://github.com/mietek/halcyon.git /app/halcyon
    - mv ~/.cabal/config ~/.cabal/config.original
    - /app/halcyon/halcyon build --dependencies-only

test:
  override:
    - /app/halcyon/halcyon build
    - /app/halcyon/halcyon paths > halcyon-env
    - ln -sf /app/sandbox/cabal.sandbox.config cabal.sandbox.config
    - source halcyon-env && cabal configure --enable-tests && cabal test